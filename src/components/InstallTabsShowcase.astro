---
const installOptions = [
  { id: 'curl', label: 'curl', command: 'curl -L https://github.com/NOVA-ALLRounder/main/archive/refs/heads/main.tar.gz | tar -xz' },
  { id: 'npm', label: 'npm', command: 'git clone https://github.com/NOVA-ALLRounder/main.git && cd main/web && npm install && npm run dev' },
  { id: 'bun', label: 'bun', command: 'git clone https://github.com/NOVA-ALLRounder/main.git && cd main/web && bun install && bun run dev' },
  { id: 'brew', label: 'brew', command: 'brew install rust && git clone https://github.com/NOVA-ALLRounder/main.git && cd main/core && cargo build --release' },
  { id: 'paru', label: 'paru', command: 'paru -S rustup nodejs npm && git clone https://github.com/NOVA-ALLRounder/main.git' },
];
---

<section class="animate-on-scroll">
  <div class="max-w-6xl mx-auto">
    <div class="space-y-2 mb-8">
      <p class="text-body-lg text-neutral-300">
        지금 웹사이트로 빌드 중인 프로젝트는 NOVA-ALLRounder/main 입니다.
      </p>
      <p class="text-body-lg text-neutral-300">clone, 환경설정, 빌드, 테스트, 릴리스까지 한 흐름으로 확인할 수 있습니다.</p>
    </div>

    <div
      data-install-tabs
      class="install-shell rounded-lg border border-white/10 bg-[#111318] overflow-hidden"
    >
      <div
        role="tablist"
        aria-label="Install options"
        class="install-tablist flex items-center gap-8 px-6 md:px-8 border-b border-white/10 bg-[#14161b]"
      >
        {installOptions.map((item, index) => (
          <button
            type="button"
            role="tab"
            class:list={[
              'install-tab relative py-5 text-xl md:text-[2rem] leading-none transition-colors',
              index === 0 ? 'text-neutral-100' : 'text-neutral-500 hover:text-neutral-300',
            ]}
            aria-selected={index === 0 ? 'true' : 'false'}
            data-active={index === 0 ? 'true' : 'false'}
            data-command={item.command}
            data-tab-id={item.id}
          >
            {item.label}
          </button>
        ))}
      </div>

      <div class="install-command-row flex items-center justify-between gap-4 px-6 md:px-8 py-7 md:py-8">
        <code
          data-install-command
          class="install-command text-xl md:text-[2rem] leading-tight text-neutral-200 font-medium overflow-x-auto whitespace-nowrap"
        >
          {installOptions[0].command}
        </code>
        <button
          type="button"
          data-install-copy
          class="install-copy inline-flex items-center justify-center h-10 w-10 rounded-md text-neutral-500 hover:text-neutral-200 transition-colors flex-shrink-0"
          aria-label="Copy install command"
          title="Copy install command"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke-width="1.5"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke-width="1.5"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="mt-10 rounded-lg border border-white/10 overflow-hidden bg-[#0b0c10]">
      <div class="grid lg:grid-cols-[1fr_320px]">
        <div class="border-b lg:border-b-0 lg:border-r border-white/10">
          <div class="p-4 md:p-5 text-[12px] md:text-[13px] leading-6 text-neutral-500 font-mono">
            <p>Clone <span class="text-neutral-300">NOVA-ALLRounder/main</span> repository</p>
            <p>Open <span class="text-neutral-300">core/.env</span> and set OPENAI_API_KEY</p>
            <p>Build core binary with <span class="text-neutral-300">cargo build --release</span></p>
            <p class="text-[#8fd5a6]">Run core process: <span class="text-[#8fd5a6]">./target/release/core</span></p>
            <p>Run validation tests with <span class="text-neutral-300">cargo test</span></p>
            <p>Build desktop bundle via <span class="text-neutral-300">./scripts/build_release.sh</span></p>
            <p>Deploy web/docs module after release artifacts are ready</p>
          </div>

          <div class="p-4 md:p-5 border-t border-white/10">
            <div class="relative rounded-md border border-white/10 bg-[#08090c] overflow-hidden">
              <div class="absolute inset-y-0 left-[46%] w-[22%] bg-[#55d2ff22] border-y border-x border-[#55d2ff66]"></div>
              <div class="absolute left-0 right-0 top-[47%] h-[2px] bg-[#9b6bff33]"></div>
              <pre class="relative m-0 p-4 text-[11px] md:text-xs leading-6 text-neutral-500 overflow-x-auto"><code>{`core/src/
├── main.rs
├── analyzer.rs
├── db.rs
├── policy.rs
├── executor.rs
├── llm_gateway.rs
├── notifier.rs
├── monitor.rs
├── applescript.rs
├── n8n_api.rs
├── visual_driver.rs
└── macos/`}</code></pre>
            </div>
          </div>
        </div>

        <aside class="p-4 md:p-5 bg-[#0f1116]">
          <h3 class="text-neutral-100 text-sm md:text-base font-semibold mb-4">
            Building NOVA-ALLRounder/main
          </h3>
          <div class="space-y-4 text-xs md:text-sm">
            <div>
              <p class="text-neutral-500 mb-1">Repository</p>
              <p class="text-neutral-300">NOVA-ALLRounder/main</p>
              <p class="text-neutral-400">Branch: main</p>
              <p class="text-neutral-400">Rust Native Agent</p>
            </div>
            <div>
              <p class="text-neutral-500 mb-1">Modules</p>
              <ul class="space-y-1 text-neutral-300">
                <li>• core (Rust)</li>
                <li>• desktop (Tauri)</li>
                <li>• web/docs</li>
              </ul>
            </div>
            <div>
              <p class="text-neutral-500 mb-1">Pipeline</p>
              <ul class="space-y-1 text-neutral-400">
                <li>[x] clone repository</li>
                <li>[x] configure .env</li>
                <li>[x] build core binary</li>
                <li class="text-[#8fd5a6]">[ ] run release bundle script</li>
                <li>[ ] publish website updates</li>
              </ul>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
</section>

<style>
  .install-tab[data-active='true']::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -1px;
    height: 2px;
    background: #f5ee9b;
  }

  .install-command {
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: -0.01em;
  }

  .install-copy:focus-visible {
    outline: 2px solid #f5ee9b;
    outline-offset: 2px;
  }

  @media (max-width: 768px) {
    .install-tablist {
      gap: 1.25rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .install-tablist::-webkit-scrollbar {
      display: none;
    }
  }
</style>

<script>
  const groups = document.querySelectorAll('[data-install-tabs]');

  groups.forEach((group) => {
    const tabs = Array.from(group.querySelectorAll('.install-tab'));
    const commandEl = group.querySelector('[data-install-command]');
    const copyBtn = group.querySelector('[data-install-copy]');

    if (!tabs.length || !commandEl || !copyBtn) return;

    const activateTab = (tab) => {
      tabs.forEach((t) => {
        const active = t === tab;
        t.setAttribute('aria-selected', String(active));
        t.setAttribute('data-active', String(active));
        t.classList.toggle('text-neutral-100', active);
        t.classList.toggle('text-neutral-500', !active);
      });
      const nextCommand = tab.getAttribute('data-command');
      if (nextCommand) commandEl.textContent = nextCommand;
    };

    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => activateTab(tab));
      tab.addEventListener('keydown', (event) => {
        if (event.key !== 'ArrowLeft' && event.key !== 'ArrowRight') return;
        event.preventDefault();
        const offset = event.key === 'ArrowRight' ? 1 : -1;
        const nextIndex = (index + offset + tabs.length) % tabs.length;
        tabs[nextIndex].focus();
        activateTab(tabs[nextIndex]);
      });
    });

    copyBtn.addEventListener('click', async () => {
      const text = commandEl.textContent?.trim();
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.classList.add('text-[#f5ee9b]');
        setTimeout(() => copyBtn.classList.remove('text-[#f5ee9b]'), 900);
      } catch {
        // Clipboard permission may be blocked by browser settings.
      }
    });
  });
</script>
